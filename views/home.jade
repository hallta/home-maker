doctype html
html(lang='en')
    link(href='//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css', rel='stylesheet')
    link(href='//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css', rel='stylesheet')

    script(src='//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js')
    script(src='//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js')
    script(src='//unpkg.com/dropbox/dist/Dropbox-sdk.min.js')

    style.
        body {
            background: rgba(0, 0, 0, 0.86);
            height: 100%;
        }

        .hide {
            display: none;
        }

        .row.green .col-lg-2 {
            background: #2E862E;
        }

        .row.blue .col-lg-2 {
            background: rgb(71, 71, 255);
        }

        .col-lg-2 {
            border: 2px solid rgba(0, 0, 0, 0.86);
            padding: 40px 15px;
        }

        .col-lg-2.center {
            text-align: center;
        }

        .col-lg-2.pointer {
            cursor: pointer;
        }

        i.fa {
            font-size: 2em;
            display: block;
            text-align: center;
        }

        .col-lg-2 i.fa, .col-lg-2 span {
            color: white;
        }

        i.fa span {
            font-family: arial;
            padding-left: 10px;
        }

        p.hm-weather {
            font-size: 8px;
            padding: 0px;
            margin-bottom: -46px;
            padding-top: 10px;
        }

        .photo-container div div img {
            margin-top: 10px;
            border: 5px solid #4e4e4e;
            max-height: 450px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

    script(type='text/javascript').
        var main = function() {
            var config = {
                weather: {
                    city_id: '5787829',
                    key: '6fe9edcc59da1a68cd186be6f7aa3783'
                }
            };

            var store = {
                config: !{config},
                weather: {
                    index: -1
                },
                photos: {
                    interval: undefined
                }
            };

            var $get = function get(url, data, callback) {
                $.ajax({
                    url: url,
                    data: data,
                    success: callback 
                });
            };

            var weather = function weather() {
                var makeWeather = function makeWeather(data) {
                    store.weather.index = store.weather.index + 1;
                    var index = store.weather.index;
                    var K = data.list[index].main.temp;
                    var F = ((K-273.15)*1.8)+32;

                    $('.weather')
                        .text(parseInt(F) + String.fromCharCode(parseInt('00B0', 16)))
                        .parent().parent()
                        .unbind('click').click(function() {
                            makeWeather(data);
                        })
                    ;

                    if (index > 0) {
                        $('.weather').append($('<p class="hm-weather"></p>').text(data.list[index].dt_txt));
                    }
                };

                $get(
                    'http://api.openweathermap.org/data/2.5/forecast',
                    {
                        id: config.weather.city_id,
                        appid: config.weather.key
                    },
                    function(d) {
                        makeWeather(d, store.weather.index);
                        store.weather.data = d;
                    }
                );
            };

            var time = function time() {
                var d = new Date();
                var hour = d.getHours();
                var min = d.getMinutes();
                var suff = 'AM';

                if (hour > 12) {
                    hour = hour - 12;
                    suff = 'PM'
                }

                $('.clock').text(hour + ':' + min + ' ' + suff);
            };

            var date = function date() {
                var d = new Date();
                var date = (d.getMonth() + 1) + '/' + d.getDate() + '/' + d.getFullYear();

                $('.calendar').text(date);
            };

            var battery = function battery() {
                navigator.getBattery().then(function(battery) {
                    var level = battery.level;
                    $('.battery').text( (level * 100) + '%' );
                })
            };

            var music = function music() {
                $('.fa-music').parent().click(function() {
                    window.location = 'https://www.pandora.com'; 
                });
            };

            var photos = function photos() {
                var dbx = new Dropbox({ accessToken: '' });
                var pics = [];

                dbx.filesListFolder({path: ''})
                    .then(function(res) {
                        for ( i in res.entries ) {
                            dbx.filesGetTemporaryLink({ path: res.entries[i].path_display })
                                .then(function(r) {
                                    pics.push(r.link);
                                }).catch(function(e) {
                                    alert(e);
                                });
                        }

                    }).catch(function(error) {
                        alert(error);
                    });

                $('.photo-show').unbind('click').click(function() {
                    $('.button-container').fadeOut('fast', function() {
                        $('.photo-container').fadeIn('fast').removeClass('hidden').click(function() {
                            clearInterval(store.photos.interval);
                            $('.photo-container').fadeOut('fast', function() {
                                $('.button-container').fadeIn('fast');
                            });
                        });

                        var i = 0;
                        var cyclePhotos = function cyclePhotos() {
                            $('img.photo-holster').attr('src', pics[i]).attr('_index', i);
                            i = ( i + 1 ) % pics.length;
                        };

                        store.photos.interval = setInterval(cyclePhotos, 5000)
                        cyclePhotos();
                    });
                });
            };

            weather();
            time();
            date();
            battery();
            music();
            photos();
        };
    body
        .photo-container.hidden
            .row
                .col-lg-offset-2.col-md-offset-2.col-sm-offset-2.col-lg-8.col-md-8.col-sm-8
                    img.photo-holster(src='')
        .button-container
            .row.green
                .col-lg-offset-2.col-md-offset-2.col-sm-offset-2.col-lg-2.col-md-2.col-sm-2.pointer
                    i.fa.fa-sun-o
                        span.weather
                .col-lg-2.col-md-2.col-sm-2
                    i.fa.fa-clock-o
                        span.clock
                .col-lg-2.col-md-2.col-sm-2
                    i.fa.fa-calendar 
                        span.calendar
                .col-lg-2.col-md-2.col-sm-2
                    i.fa.fa-battery-full
                        span.battery
                    
            .row.blue
                .col-lg-offset-2.col-md-offset-2.col-sm-offset-2.col-lg-2.col-md-2.col-sm-2.pointer.center
                    i.fa.fa-music
                .col-lg-2.col-md-2.col-sm-2.pointer.photo-show
                    i.fa.fa-camera-retro
                .hide.col-lg-2.col-md-2.col-sm-2
                    | content
                .hide.col-lg-2.col-md-2.col-sm-2
                    | content

            .hide.row
                .col-lg-offset-2.col-md-offset-2.col-sm-offset-2.col-lg-2.col-md-2.col-sm-2
                    | content
                .col-lg-2.col-md-2.col-sm-2
                    | content
                .col-lg-2.col-md-2.col-sm-2
                    | content
                .col-lg-2.col-md-2.col-sm-2
                    | content
        
        script(type='text/javascript').
            //setInterval(main, 60000);
            main();




